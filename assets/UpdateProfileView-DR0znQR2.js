import{P as y}from"./ProfileLayout-J8UFxBt5.js";import{u as b,g as h}from"./authService-Aa4usrHm.js";import{_ as M,s as k,w as P,g as w,o as n,b as r,c as a,d,t as f,e as C,x as g,C as c,n as u,y as p,E as _}from"./index-DzVFwCgQ.js";import"./Nita-logo-CbE_mBG5.js";const L={name:"UpdateProfileView",components:{ProfileLayout:y},data(){return{form:{first_name:"",last_name:"",email:"",gender:"",date_of_birth:"",category:"",organisation:""},originalForm:{},errors:{},errorMessage:"",successMessage:"",emailVerificationPending:!1,isLoading:!1,username:""}},computed:{hasChanges(){return Object.keys(this.form).some(o=>this.form[o]!==this.originalForm[o])}},mounted(){this.loadUserData()},methods:{loadUserData(){const o=h();o&&o.user?(this.username=o.user.username,this.form={first_name:o.user.first_name||"",last_name:o.user.last_name||"",email:o.user.email||"",gender:o.user.gender||"",date_of_birth:o.user.date_of_birth||"",category:o.user.category||"",organisation:o.user.organisation||""},this.originalForm={...this.form}):this.$router.push("/login")},clearError(o){this.errors[o]&&(this.errors[o]=""),this.errorMessage&&(this.errorMessage=""),this.successMessage&&(this.successMessage="")},validateForm(){this.errors={};let o=!0;return this.form.first_name.trim()||(this.errors.first_name="First name is required",o=!1),this.form.last_name.trim()||(this.errors.last_name="Last name is required",o=!1),this.form.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.form.email)||(this.errors.email="Please enter a valid email address",o=!1):(this.errors.email="Email is required",o=!1),o},async handleSubmit(){if(this.validateForm()){this.errorMessage="",this.successMessage="",this.emailVerificationPending=!1,this.isLoading=!0;try{const o={};Object.keys(this.form).forEach(m=>{this.form[m]!==this.originalForm[m]&&(o[m]=this.form[m]||null)});const e=await b(this.username,o);e.email_verification_pending?(this.emailVerificationPending=!0,this.successMessage="Profile updated! Email verification sent."):this.successMessage=e.message||"Profile updated successfully!";const t=h();t&&t.user&&(Object.keys(o).forEach(m=>{(m!=="email"||!this.emailVerificationPending)&&(t.user[m]=this.form[m])}),localStorage.setItem("user",JSON.stringify(t.user))),this.originalForm={...this.form},window.scrollTo({top:0,behavior:"smooth"})}catch(o){if(console.error("Profile update error:",o),o.response){const e=o.response.status,t=o.response.data;e===400?(t.email&&(this.errors.email=Array.isArray(t.email)?t.email[0]:t.email),t.first_name&&(this.errors.first_name=Array.isArray(t.first_name)?t.first_name[0]:t.first_name),t.last_name&&(this.errors.last_name=Array.isArray(t.last_name)?t.last_name[0]:t.last_name),this.errorMessage=t.detail||t.message||"Please check the form for errors"):e===403?this.errorMessage="You do not have permission to update this profile":e>=500?this.errorMessage="Server error. Please try again later.":this.errorMessage=t.detail||t.message||"Failed to update profile"}else o.request?this.errorMessage="Network error. Please check your internet connection.":this.errorMessage="An unexpected error occurred. Please try again.";window.scrollTo({top:0,behavior:"smooth"})}finally{this.isLoading=!1}}},handleCancel(){this.form={...this.originalForm},this.errors={},this.errorMessage="",this.successMessage=""}}},V={class:"update-profile"},x={key:0,class:"success-alert"},E={class:"alert-content"},S={class:"alert-title"},U={key:0,class:"alert-subtitle"},F={key:1,class:"error-alert"},O={class:"error-text"},I={class:"form-section"},B={class:"form-row"},N={class:"form-group"},q=["disabled"],z={key:0,class:"field-error"},A={class:"form-group"},D=["disabled"],j={key:0,class:"field-error"},T={class:"form-group"},G=["disabled"],Y={key:0,class:"field-error"},H={class:"form-row"},J={class:"form-group"},K=["disabled"],Q={key:0,class:"field-error"},R={class:"form-group"},W=["disabled"],X={key:0,class:"field-error"},Z={class:"form-section"},$={class:"form-row"},ee={class:"form-group"},re=["disabled"],se={key:0,class:"field-error"},oe={class:"form-group"},ie=["disabled"],te={key:0,class:"field-error"},ne={class:"form-actions"},le=["disabled"],ae=["disabled"],de={key:0},me={key:1,class:"btn-loading-content"};function fe(o,e,t,m,s,l){const v=w("ProfileLayout");return n(),k(v,null,{default:P(()=>[r("div",V,[e[31]||(e[31]=r("div",{class:"page-header"},[r("h1",{class:"page-title"},"Update Profile"),r("p",{class:"page-subtitle"},"Manage your personal information and account details")],-1)),s.successMessage?(n(),a("div",x,[e[16]||(e[16]=r("svg",{class:"success-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),r("div",E,[r("p",S,f(s.successMessage),1),s.emailVerificationPending?(n(),a("p",U," Please check your new email to verify the change. ")):d("",!0)])])):d("",!0),s.errorMessage?(n(),a("div",F,[e[17]||(e[17]=r("svg",{class:"error-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),r("p",O,f(s.errorMessage),1)])):d("",!0),r("form",{onSubmit:e[15]||(e[15]=C((...i)=>l.handleSubmit&&l.handleSubmit(...i),["prevent"])),class:"profile-form"},[r("div",I,[e[25]||(e[25]=r("h2",{class:"section-title"},"Personal Information",-1)),r("div",B,[r("div",N,[e[18]||(e[18]=r("label",{for:"firstName",class:"form-label"},[c("First Name "),r("span",{class:"required"},"*")],-1)),g(r("input",{id:"firstName","onUpdate:modelValue":e[0]||(e[0]=i=>s.form.first_name=i),type:"text",placeholder:"Enter your first name",class:u(["form-input",{"input-error":s.errors.first_name}]),disabled:s.isLoading,required:"",onInput:e[1]||(e[1]=i=>l.clearError("first_name"))},null,42,q),[[p,s.form.first_name]]),s.errors.first_name?(n(),a("p",z,f(s.errors.first_name),1)):d("",!0)]),r("div",A,[e[19]||(e[19]=r("label",{for:"lastName",class:"form-label"},[c("Last Name "),r("span",{class:"required"},"*")],-1)),g(r("input",{id:"lastName","onUpdate:modelValue":e[2]||(e[2]=i=>s.form.last_name=i),type:"text",placeholder:"Enter your last name",class:u(["form-input",{"input-error":s.errors.last_name}]),disabled:s.isLoading,required:"",onInput:e[3]||(e[3]=i=>l.clearError("last_name"))},null,42,D),[[p,s.form.last_name]]),s.errors.last_name?(n(),a("p",j,f(s.errors.last_name),1)):d("",!0)])]),r("div",T,[e[20]||(e[20]=r("label",{for:"email",class:"form-label"},[c(" Email Address "),r("span",{class:"required"},"*")],-1)),g(r("input",{id:"email","onUpdate:modelValue":e[4]||(e[4]=i=>s.form.email=i),type:"email",placeholder:"you@example.com",class:u(["form-input",{"input-error":s.errors.email}]),disabled:s.isLoading,required:"",onInput:e[5]||(e[5]=i=>l.clearError("email"))},null,42,G),[[p,s.form.email]]),s.errors.email?(n(),a("p",Y,f(s.errors.email),1)):d("",!0),e[21]||(e[21]=r("p",{class:"field-hint"},[r("svg",{class:"hint-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),c(" If you change your email, you'll need to verify it before it updates ")],-1))]),r("div",H,[r("div",J,[e[23]||(e[23]=r("label",{for:"gender",class:"form-label"},"Gender",-1)),g(r("select",{id:"gender","onUpdate:modelValue":e[6]||(e[6]=i=>s.form.gender=i),class:u(["form-select",{"input-error":s.errors.gender}]),disabled:s.isLoading,onChange:e[7]||(e[7]=i=>l.clearError("gender"))},[...e[22]||(e[22]=[r("option",{value:""},"Select your gender",-1),r("option",{value:"M"},"Male",-1),r("option",{value:"F"},"Female",-1),r("option",{value:"O"},"Other",-1)])],42,K),[[_,s.form.gender]]),s.errors.gender?(n(),a("p",Q,f(s.errors.gender),1)):d("",!0)]),r("div",R,[e[24]||(e[24]=r("label",{for:"dateOfBirth",class:"form-label"},"Date of Birth",-1)),g(r("input",{id:"dateOfBirth","onUpdate:modelValue":e[8]||(e[8]=i=>s.form.date_of_birth=i),type:"date",class:u(["form-input",{"input-error":s.errors.date_of_birth}]),disabled:s.isLoading,onInput:e[9]||(e[9]=i=>l.clearError("date_of_birth"))},null,42,W),[[p,s.form.date_of_birth]]),s.errors.date_of_birth?(n(),a("p",X,f(s.errors.date_of_birth),1)):d("",!0)])])]),r("div",Z,[e[29]||(e[29]=r("h2",{class:"section-title"},"Professional Information",-1)),r("div",$,[r("div",ee,[e[27]||(e[27]=r("label",{for:"category",class:"form-label"},"Category",-1)),g(r("select",{id:"category","onUpdate:modelValue":e[10]||(e[10]=i=>s.form.category=i),class:u(["form-select",{"input-error":s.errors.category}]),disabled:s.isLoading,onChange:e[11]||(e[11]=i=>l.clearError("category"))},[...e[26]||(e[26]=[r("option",{value:""},"Select category (Optional)",-1),r("option",{value:"Individual"},"Individual",-1),r("option",{value:"Organization"},"Organization",-1),r("option",{value:"Government"},"Government",-1),r("option",{value:"Private Sector"},"Private Sector",-1),r("option",{value:"Student"},"Student",-1)])],42,re),[[_,s.form.category]]),s.errors.category?(n(),a("p",se,f(s.errors.category),1)):d("",!0)]),r("div",oe,[e[28]||(e[28]=r("label",{for:"organisation",class:"form-label"},"Organization",-1)),g(r("input",{id:"organisation","onUpdate:modelValue":e[12]||(e[12]=i=>s.form.organisation=i),type:"text",placeholder:"Your organization (Optional)",class:u(["form-input",{"input-error":s.errors.organisation}]),disabled:s.isLoading,onInput:e[13]||(e[13]=i=>l.clearError("organisation"))},null,42,ie),[[p,s.form.organisation]]),s.errors.organisation?(n(),a("p",te,f(s.errors.organisation),1)):d("",!0)])])]),r("div",ne,[r("button",{type:"button",onClick:e[14]||(e[14]=(...i)=>l.handleCancel&&l.handleCancel(...i)),class:"btn-secondary",disabled:s.isLoading}," Cancel ",8,le),r("button",{type:"submit",class:u(["btn-primary",{"btn-loading":s.isLoading}]),disabled:s.isLoading||!l.hasChanges},[s.isLoading?(n(),a("span",me,[...e[30]||(e[30]=[r("svg",{class:"spinner",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),r("span",null,"Saving...",-1)])])):(n(),a("span",de,"Save Changes"))],10,ae)])],32)])]),_:1})}const he=M(L,[["render",fe],["__scopeId","data-v-c1700d57"]]);export{he as default};
